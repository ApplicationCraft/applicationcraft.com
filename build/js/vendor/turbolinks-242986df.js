(function(){var anchoredLink,assets,assetsChanged,browserCompatibleDocumentParser,browserSupportsPushState,cacheCurrentPage,changePage,constrainPageCacheTo,createDocument,crossOriginLink,currentState,executeScriptTags,extractAssets,extractLink,extractTitleAndBody,fetchHistory,fetchReplacement,handleClick,ignoreClick,initialized,installClickHandlerLast,intersection,noTurbolink,nonHtmlLink,nonStandardClick,pageCache,recallScrollPosition,referer,reflectNewUrl,reflectRedirectedUrl,rememberCurrentAssets,rememberCurrentState,rememberCurrentUrl,rememberInitialPage,resetScrollPosition,samePageLink,triggerEvent,visit,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};initialized=!1,currentState=null,referer=document.location.href,assets=[],pageCache=[],createDocument=null,visit=function(e){return browserSupportsPushState?(cacheCurrentPage(),reflectNewUrl(e),fetchReplacement(e)):document.location.href=e},fetchReplacement=function(e){var t,n=this;return triggerEvent("page:fetch"),t=new XMLHttpRequest,t.open("GET",e,!0),t.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),t.setRequestHeader("X-XHR-Referer",referer),t.onload=function(){var n;return n=createDocument(t.responseText),assetsChanged(n)?document.location.href=e:(changePage.apply(null,extractTitleAndBody(n)),reflectRedirectedUrl(t),resetScrollPosition(),triggerEvent("page:load"))},t.onabort=function(){return console.log("Aborted turbolink fetch!")},t.send()},fetchHistory=function(e){var t;return cacheCurrentPage(),(t=pageCache[e.position])?(changePage(t.title,t.body,t.breadcrumbs),recallScrollPosition(t),triggerEvent("page:restore")):fetchReplacement(document.location.href)},cacheCurrentPage=function(){return rememberInitialPage(),pageCache[currentState.position]={url:document.location.href,body:document.getElementById("doc-body"),breadcrumbs:document.getElementById("breadcrumbs"),title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset},constrainPageCacheTo(10)},constrainPageCacheTo=function(e){return delete pageCache[currentState.position-e]},changePage=function(e,t,n){return document.title=e,document.getElementById("doc-body").parentNode.replaceChild(t,document.getElementById("doc-body")),document.getElementById("breadcrumbs").parentNode.replaceChild(n,document.getElementById("breadcrumbs")),executeScriptTags(),currentState=window.history.state,triggerEvent("page:change")},executeScriptTags=function(){var script,_i,_len,_ref,_ref1,_results;_ref=document.body.getElementsByTagName("script"),_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++)script=_ref[_i],((_ref1=script.type)===""||_ref1==="text/javascript")&&_results.push(eval(script.innerHTML));return _results},reflectNewUrl=function(e){if(e!==document.location.href)return referer=document.location.href,window.history.pushState({turbolinks:!0,position:currentState.position+1},"",e)},reflectRedirectedUrl=function(e){var t;if(t=e.getResponseHeader("X-XHR-Current-Location"))return window.history.replaceState(currentState,"",t)},rememberCurrentUrl=function(){return window.history.replaceState({turbolinks:!0,position:window.history.length-1},"",document.location.href)},rememberCurrentState=function(){return currentState=window.history.state},rememberCurrentAssets=function(){return assets=extractAssets(document)},rememberInitialPage=function(){if(!initialized)return rememberCurrentUrl(),rememberCurrentState(),createDocument=browserCompatibleDocumentParser(),initialized=!0},recallScrollPosition=function(e){return window.scrollTo(e.positionX,e.positionY)},resetScrollPosition=function(){return window.scrollTo(0,0)},triggerEvent=function(e){var t;return t=document.createEvent("Events"),t.initEvent(e,!0,!0),document.dispatchEvent(t)},extractAssets=function(e){var t,n,r,i,s;i=e.head.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],(t.src||t.href)&&s.push(t.src||t.href);return s},assetsChanged=function(e){return intersection(extractAssets(e),assets).length!==assets.length},intersection=function(e,t){var n,r,i,s,o;e.length>t.length&&(s=[t,e],e=s[0],t=s[1]),o=[];for(r=0,i=e.length;r<i;r++)n=e[r],__indexOf.call(t,n)>=0&&o.push(n);return o},extractTitleAndBody=function(e){var t;return t=e.querySelector("title"),[t!=null?t.textContent:void 0,e.getElementById("doc-body"),e.getElementById("breadcrumbs")]},browserCompatibleDocumentParser=function(){var e,t,n,r;return e=function(e){return(new DOMParser).parseFromString(e,"text/html")},t=function(e){var t;return t=document.implementation.createHTMLDocument(""),t.open("replace"),t.write(e),t.close,t},window.DOMParser&&(n=e("<html><body><p>test")),(n!=null?(r=n.body)!=null?r.childNodes.length:void 0:void 0)===1?e:t},installClickHandlerLast=function(e){if(!e.defaultPrevented)return document.removeEventListener("click",handleClick),document.addEventListener("click",handleClick)},handleClick=function(e){var t;if(!e.defaultPrevented){t=extractLink(e);if(t.nodeName==="A"&&!ignoreClick(e,t))return visit(t.href),e.preventDefault()}},extractLink=function(e){var t;t=e.target;while(t!==document&&t.nodeName!=="A")t=t.parentNode;return t},samePageLink=function(e){return e.href===document.location.href},crossOriginLink=function(e){return location.protocol!==e.protocol||location.host!==e.host},anchoredLink=function(e){return(e.hash&&e.href.replace(e.hash,""))===location.href.replace(location.hash,"")||e.href===location.href+"#"},nonHtmlLink=function(e){return e.href.match(/\.[a-z]+(\?.*)?$/g)&&!e.href.match(/\.html?(\?.*)?$/g)},noTurbolink=function(e){var t;while(!t&&e!==document)t=e.getAttribute("data-no-turbolink")!=null,e=e.parentNode;return t},nonStandardClick=function(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey},ignoreClick=function(e,t){return crossOriginLink(t)||anchoredLink(t)||nonHtmlLink(t)||noTurbolink(t)||nonStandardClick(e)},browserSupportsPushState=window.history&&window.history.pushState&&window.history.replaceState&&window.history.state!==void 0,browserSupportsPushState&&(rememberCurrentAssets(),document.addEventListener("click",installClickHandlerLast,!0),window.addEventListener("popstate",function(e){var t;if((t=e.state)!=null?t.turbolinks:void 0)return fetchHistory(e.state)})),this.Turbolinks={visit:visit}}).call(this);