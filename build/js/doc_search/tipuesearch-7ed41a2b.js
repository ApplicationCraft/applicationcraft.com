/*
Tipue Search 2.0
Copyright (c) 2012 Tipue
Tipue Search is released under the MIT License
http://www.tipue.com/search
*/
(function(e){e.fn.tipuesearch=function(t){var n=e.extend({show:7,newWindow:!1,showURL:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!1,highlightEveryTerm:!1,mode:"static",contentLocation:"tipuesearch/tipuesearch_content.json"},t);return this.each(function(){function i(e){return decodeURIComponent(((new RegExp("[?|&]"+e+"="+"([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function s(i,o){e("#tipue_search_content").hide();var u="",a="",f=!1,l=!1,c=e(".docs aside form input").val().toLowerCase();c=e.trim(c);var h=c.split(" ");if(c.length>=n.minimumLength){if(o){var p=c;for(var d=0;d<h.length;d++)for(var v=0;v<tipuesearch_replace.words.length;v++)h[d]==tipuesearch_replace.words[v].word&&(c=c.replace(h[d],tipuesearch_replace.words[v].replace_with),f=!0);h=c.split(" ")}var m=c;for(var d=0;d<h.length;d++)for(var v=0;v<tipuesearch_stem.words.length;v++)h[d]==tipuesearch_stem.words[v].word&&(m=m+" "+tipuesearch_stem.words[v].stem);h=m.split(" ");var g=0;found=new Array;for(var d=0;d<t.pages.length;d++){if(t.pages[d].t==undefined)continue;var y=1e7,b=t.pages[d].t;for(var v=0;v<h.length;v++){var w=new RegExp(h[v],"i");t.pages[d].t.search(w)!=-1&&(y-=2e3-d),t.pages[d].text&&t.pages[d].text.search(w)!=-1&&(y-=1500-d);if(n.highlightTerms){if(n.highlightEveryTerm)var E=new RegExp("("+h[v]+")","gi");else var E=new RegExp("("+h[v]+")","i");b=b.replace(E,"<em>$1</em>")}t.pages[d].b.search(w)!=-1&&(y-=1e3-d)}y<1e7&&(found[g++]=y+"^"+t.pages[d].r+"^"+b+"^"+t.pages[d].u)}if(g!=0){f==1&&(u+='<div id="tipue_search_warning_head">Showing results for '+c+"</div>",u+='<div id="tipue_search_warning">Show results for <a href="javascript:void(0)" id="tipue_search_replaced">'+p+"</a></div>"),g==1?u+='<div id="tipue_search_results_count">1 result for '+c+"...</div>":(c_c=g.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),u+='<div id="tipue_search_results_count">'+c_c+" results for "+c+"...</div>"),found.sort();var S=0;for(var d=0;d<found.length;d++){var x=found[d].split("^");if(S>=i&&S<n.show+i){u+='<div id="tipue_search_content_title"><a href="'+x[3]+'"'+r+">"+x[1]+"</a></div>";var T=x[2],N="",C=T.split(" ");if(C.length<n.descriptiveWords)N=T;else for(var v=0;v<n.descriptiveWords;v++)N+=C[v]+" ";N=e.trim(N),N.charAt(N.length-1)!="."&&(N+=" ..."),u+='<div id="tipue_search_content_text">'+N+"</div>",n.showURL&&(u+='<div id="tipue_search_content_loc"><a href="'+x[3]+'"'+r+">"+x[3]+"</a></div>")}S++}if(g>n.show){var k=Math.ceil(g/n.show),L=i/n.show;u+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',i>0&&(u+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(i-n.show)+"_"+o+'">&#171; Previous</a></li>');if(L<=4){var A=k;k>5&&(A=5);for(var v=0;v<A;v++)v==L?u+='<li class="current">'+(v+1)+"</li>":u+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+v*n.show+"_"+o+'">'+(v+1)+"</a></li>"}else{var A=k+4;A>k&&(A=k);for(var v=L;v<A;v++)v==L?u+='<li class="current">'+(v+1)+"</li>":u+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+v*n.show+"_"+o+'">'+(v+1)+"</a></li>"}L+1!=k&&(u+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(i+n.show)+"_"+o+'">Next &#187;</a></li>'),u+="</ul></div>"}}else u+='<div id="tipue_search_warning_head">Nothing found</div>'}else l?u+='<div id="tipue_search_warning_head">Nothing found</div><div id="tipue_search_warning">Common words are largely ignored</div>':(u+='<div id="tipue_search_warning_head">Search too short</div>',n.minimumLength==1?u+='<div id="tipue_search_warning">Should be one character or more</div>':u+='<div id="tipue_search_warning">Should be '+n.minimumLength+" characters or more</div>");e(".docs article").fadeOut(function(){e("#tipue_search_content").html(u).fadeIn()}),e("#tipue_search_replaced").click(function(){s(0,!1)}),e(".tipue_search_foot_box").click(function(){var t=e(this).attr("id"),n=t.split("_");s(parseInt(n[0]),n[1])})}var t={pages:[]};e.ajaxSetup({async:!1}),n.mode=="json"&&e.getJSON(n.contentLocation,function(n){t=e.extend({},n)}),n.mode=="static"&&(t=e.extend({},tipuesearch));var r="";n.newWindow&&(r=' target="_blank"'),i("q")&&(e(".docs aside form input").val(i("q")),s(0,!0)),e(".docs aside form").submit(function(){return s(0,!0),!1})})}})(jQuery);